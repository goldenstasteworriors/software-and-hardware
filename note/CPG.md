

仿生：模拟中级中枢（在接收到不同的高级中枢信号后产生不同的）节律信号来控制手脚等运动





论文不理解的地方：

1. x,y分别是什么，输出给什么地方
2. 相邻振荡器耦合是什么策略，这个旋转，耦合矩阵的耦合项是啥
3. 耦合取(经过耦合因子变换的)i-1项的x和i+1项的y？
4. y是输出，w,a,b是振荡器的输入？x是什么？w,a,b不是三个参数吗为啥会是输入
5. 这耦合因子矩阵和相位差矩阵什么玩意，是用来左乘什么的？
6. 真是确定耦合因子和相位差矩阵改变w,a,b的，这样目的是啥呢



xdot = 


$$
\begin{cases}

\ xdot = -\omega y +kx(a^2-x^2-y^2)+M(x,y)+s\\
\ ydot = \omega x + k y(a^2-x^2-y^2)+N(x,y)-s
\end{cases}
$$




w=pi;a=4;k=0.5    :基准

![image-20241016213645690](../../pictrue/image-20241016213645690.png)

w=pi;a=4;k=0.1     :k控制收敛速度

![image-20241016213722622](../../pictrue/image-20241016213722622.png)

w=pi;a=16;k=0.5      :a控制振幅

![image-20241016214010094](../../pictrue/image-20241016214010094.png)

w=pi/2;a=4;k=0.5   :w控制频率

![image-20241016214058404](../../pictrue/image-20241016214058404.png)



t=15后,w从pi变为pi/2



转向模态：![image-20241017205204511](../../pictrue/image-20241017205204511.png)

![image-20241017205139783](../../pictrue/image-20241017205139783.png)



15s后h12和h23从0.2变为10

![image-20241023225815686](../../pictrue/image-20241023225815686.png)



在15s把h12,h32从0.2变为1

![image-20241023230319070](../../pictrue/image-20241023230319070.png)

小幅度变化h会使得波形变得不好(h是可以算出来的？)



15s后phi12和phi21从pi变为pi/2

![image-20241023230735870](../../pictrue/image-20241023230735870.png)

确实phi就是相位差，且可以调整



只改phi12,phi21不变

![image-20241023231007722](../../pictrue/image-20241023231007722.png)

无意义



只改w2不改w1

![image-20241023231311511](../../pictrue/image-20241023231311511.png)

无意义



CPG只作为一个模态发生器，先把代码调出来测得不同w,a,b对应的v,w，然后再在这个基础上套轨迹跟踪和姿态

自己取dt就能在板子上跑

通过其它参数来实现多模态，不一定要改那俩矩阵



高层控制：

区别

1. 是否用CPG中的反馈
2. 是否再抽象一层

方法：

1. 用转换函数拟合CPG参数和线速度，角速度的关系,上层全部采用另一层抽象
2. 没有更上一层的抽象，直接用PID/模糊逻辑/强化学习等方法由航向/偏航等得到CPG参数
3. 直接用



感知：

1. GPS/INS





要看的14 15，怎么根据传感器数据进行动力学建模



把伸缩加进扑动过程中以实现调节俯仰(深度)：往下扑动时尽可能伸长，往下扑动时尽可能缩短

加入方式：

1. (目前方式)：检测扑动舵机是否到一定角度(相位)然后开最高速度伸缩
2. (也许)：把伸缩舵机也耦合到CPG中，如需固定某位置则停振(很可能有希望的一个点子，但实在想不太出来这个和双模态(保持+最高速度伸缩)相比优点在哪，可能多一个控制量会在用DRL后发生质变？)



在最大点再伸缩：

![image-20241210203528768](../../pictrue/image-20241210203528768.png)





定时器对应的API：

定时器0：delay()|、millis()、micros()；

定时器1：Servo库(Mega 2560为定时器5)；

定时器2：tone() ；software serial

定时器对应Arduino Uno的PWM口：

定时器0：PWM口：5、6(默认976Hz)

定时器1：PWM口：9、10(默认490Hz)

定时器2：PWM口：11、3(默认490Hz)




定时器使用情况:

timer1:用于软串口。软串口负责与遥控通信









周期为2pi/omega



![image-20240510224730982](D:\NEW_MY\pictrue\image-20240510224730982.png)



连线:VCC接5V,GND接GND，S端口接arduinoRX接口





左上下:频率

左左右:无要求

右上下:左右相位差(伸缩时机)

右左右:只打左/右伸缩

上旋钮:尾翼





## 遥控逻辑

| 位置       |      功能      | 通道 |         具体范围          |
| ---------- | :------------: | :--: | :-----------------------: |
| 左遥杆上下 |      频率      |  3   | 向上-->频率变快(0.25-0.4) |
| 左摇杆左右 |    暂无要求    |  4   |                           |
| 右遥杆上下 | 伸缩时机相位差 |  2   |      向上->提前伸缩       |
| 右遥杆左右 | 只用左/右伸缩  |  1   |    向左->只有左边伸缩     |
| 左旋钮     |   左尾翼角度   |  5   |                           |
| 右旋钮     |   右尾翼角度   |  6   |                           |







### 调代码遇到的问题及解决

1. 串口绘图仪横坐标范围修改在`resources\app\node_modules\arduino-serial-plotter-webapp\build\static\js\main.xxxx.chunk.js`改`Object(o.useState)(50) `

2. loop部分全部注释只留下 IBus.loop()和data_update(millis())和最后delay(5)，没有问题，在IBUS.loop()后delay(10)就有问题了,把出问题的地方换成delay(5)和delay(2)刚开始都没有问题，但milllis到32000左右时y0和y1都会变为nan,查看后认为是time和lasttime越界，改为long int 后delay(1)/delay(2)都可以，但delay(10)/delay(5)从开始时会直接变为nan;确认和delay位置无关，只和delay()长短有关

   最终结论:是setup里的delay(500)的问题，这里dt太大不能算微分了就开头就算崩了

3.  调试时串口会有杂信号

   最终结论：if(dxl.syncWrite(&sw_infos) == true){}导致的，原因未知，估计是要收答复和串口收混了

4. 加上dynamixel等部分后图像不对；初步确认问题在value传递给实际数值段

   sb了，把没得到的value赋值给omega了，暂时注释掉就行

5. 用mode_chage_phase调整比较值效果较差，需要直接用时间

6. DXL_ID1，2是左右翼摆动，3，4才是模态

7. 变模态舵机不能调具体角度，好像每次都会到一个具体角度，查看上位机发现是0位置，修改goal_pos也不能改变其位置

   后调试发现只给torque_on不会动，只用setup中的set_position可以动，目前看是移动到4096位置(与0差一圈)；把goal_pos去掉直接给2048，发现可以正常控制；换回goal_pos后又不行，初步判断为数据结构类型，可能接收不了double(但是我查了之前的程序也是double，搞不懂)

   md，究极低级错误，是因为模态舵机ID是3和4，但我一直用的goal_pos[DXL_ID-1],但是arduino的goal_pos溢出了没报而是直接给的0

5. 串口收不到信息



mode_chage_phase = 0

![image-20241223221124722](../../pictrue/image-20241223221124722.png)



0

![image-20241223221304755](../../pictrue/image-20241223221304755.png)



