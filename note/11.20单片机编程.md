# 单片机编程

### 板上系统构成

1. 最小系统(包括主控芯片)：单片机能工作的最小系统
2. 外设：各种外设设备供实现各种功能
3. 接口
4. 电源：转换，稳压等功能，一般要包括一圈稳压系统等

#### 最小系统

一般包括：

1. 晶体振荡器：用作时钟
2. 主控制芯片
3. 重启按键
4. 滤波电容：转换，稳压等
5. 烧录接口：设置为高电平时才可以烧录进去
6. 外挂RAM(DDR)（现在芯片中集成有）
7. 外挂ROM(FLASH EMMC)（现在芯片中集成有） 

#### 片上系统

1. 控制器
2. 储存器：储存 程序和数据
3. 运算器

#### CPU最小系统

1. 计时器 
2. 计数器
3. 重置编码器
4. 程序储存器
5. 地址译码器
6. 指令跳转模块 

大概流程如下：![QQ图片20221120163715](C:\Users\86180\Desktop\my\note\QQ图片20221120163715.jpg)

### 片内外设资源

1. 串行通信串口(UART,SPI,I2C)  问题在于1. 慢 2. 需要相同的时间否则出大事(所以I2C等会内置一跟时钟线专门来校准)
2. 并行通信串口(PS/2,USB) 问题是要等长不然也会出事
3. 定时器TIM
4. 标准输入输出口GPIO
5. 模数转换口ADC
6. SD卡接口
7. 品目接口

### 外设资源重定向

1. 引脚复用(一段时间后更改引脚用途)
2. DMA通道
3. 总线架构(芯片中就是靠总线实现连接的，发出的消息所有设备都能收到，所以消息内容除了时间和具体指令外还要包括只有某设备执行，其他设备关机)

### 单片机软件系统架构

1. BootLoader：相当于启动时会执行的初始化，一般最后一句是进入main函数。如果只能录入一次很可能是忘记设置烧录引脚的电平状态，此时可以将BootLoader变为系统模式(对某些单片机来说给BootLoader引脚连高电平)来解决这个问题
2. Main：主函数
3. Function：遇到函数跳转
4. (Makefile)
5. (download)

### 裸机系统架构

1. 轮询系统：在裸机编程时，先初始化相关硬件，让主程序在一个死循环里面不断循环，顺序地处理各种事件。(setup loop)   明显的缺点是实时性差，如果用户输入时正好在执行其它命令则直接寄。
2. 前后台系统(中断)：事件的响应称为前台，无限循环称为后台。如果有中断就会跳出后台，中断执行完之后就会跳回后台